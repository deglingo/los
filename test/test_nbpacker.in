/* -*- c -*- */

header
{
##include "los/lpacker.h"
##include "los/lint.h"
##include "libltest/bytestream.h"

##include <unistd.h>
}

data
{
  gchar *tmpfile;
}

setup
{
  gint fd;
  GError *err = NULL;
  /* create a tmpfile */
  if ((fd = g_file_open_tmp(NULL, &data->tmpfile, &err)) < 0)
    abort(); /* [FIXME] */
  close(fd);
}

teardown
{
  unlink(data->tmpfile);
}

test /* int */
{
  LStream *stream;
  LPacker *packer;
  LObject *obj;
  GError *err = NULL;
  /* create the packer */
  stream = byte_stream_new(data->tmpfile, "w");
  packer = l_packer_new(stream);
  L_OBJECT_CLEAR(stream);
  /* pack */
  obj = L_OBJECT(l_int_new(92));
  l_packer_add(packer, obj);
  L_OBJECT_CLEAR(obj);
  /* process */
  while (!l_packer_send(packer, &err))
    {
      PIF_CHECK(!err);
    }
  /* cleanup */
  L_OBJECT_CLEAR(packer);
}
