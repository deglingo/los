/* -*- c -*- */

header
{
##include "los/lobject.h"
##include "test/lostestfake.h"
}

unit /* FakeClass */
{
  test {
    LObjectClass *cls = CLASS_FAKE;
    PIF_CHECK(cls);
    /* class initialization must call the class_init handler */
    PIF_CHECK(((FakeClass *) cls)->dummy == 42);
  }
}

unit /* Fake2Class */
{
  test {
    LObjectClass *cls = CLASS_FAKE2;
    PIF_CHECK(cls);
    /* class initialization must copy the base class and call the
       class_init handler */
    PIF_CHECK(((FakeClass *) cls)->dummy == 84);
  }
}

/* [FIXME] the tests below should ge in test_instance */

unit /* Fake */
{
  data { LObject *fake; }
  setup { data->fake = l_object_new(CLASS_FAKE, NULL); }
  teardown { /* l_object_unref(data->fake); */ }
  test {
    PIF_CHECK(data->fake);
    /* l_object_new() must call the instance_init handler */
    PIF_CHECK(((Fake *)data->fake)->instval == 3);
  }
}

unit /* Fake2 */
{
  data { LObject *fake; }
  setup { data->fake = l_object_new(CLASS_FAKE2, NULL); }
  teardown { /* l_object_unref(data->fake); */ }
  test {
    PIF_CHECK(data->fake);
  }
}
